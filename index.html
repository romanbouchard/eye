<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Explorateur de fichiers - ‚àö21,1</title>

<style>
  body { font-family: 'Segoe UI', sans-serif; background: #e0e7ff; padding: 20px; }
  h2 { color: #1e3a8a; text-shadow: 1px 1px 2px #aaa; }
  #fileTree { background: #fff; border-radius: 10px; box-shadow: 0 6px 15px rgba(0,0,0,0.25); padding: 15px; max-width: 400px; }

  .folder, .file {
    margin: 6px 0;
    cursor: pointer;
    padding: 6px 12px;
    border-radius: 5px;
    transition: background 0.2s, transform 0.2s;
    display:flex;
    align-items:center;
    gap:10px;
    width:100%;
    box-sizing:border-box;
  }

  .file span:first-child,
  .folder span:first-child {
    flex:1;
    min-width:0;
    overflow:hidden;
    text-overflow:ellipsis;
    white-space:nowrap;
  }

  .infoBtn { margin-left:auto; }

  .folder { font-weight: bold; color: #1e40af; }
  .file { color: #2563eb; }

  .folder:hover, .file:hover { background: #dbeafe; transform: scale(1.03); }

  .nested { margin-left: 20px; display: none; opacity: 0; transition: opacity 0.3s ease, max-height 0.3s ease; max-height: 0; }
  .nested.show { display: block; opacity: 1; max-height: 500px; }

  .folder::before { content: "üìÅ "; }
  .file::before { content: "üìÑ "; }
  .locked::before { content: "üîí "; }

  .infoBtn {
    cursor:pointer; font-weight:bold; color:#444; margin-left:8px;
    font-size:28px; padding:6px 12px; border-radius:6px;
    background:#dbeafe; transition:background 0.2s;
  }
  .infoBtn:hover { color:#000; background:#93c5fd; }

  #infoOverlay { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.6); display:none; justify-content:center; align-items:center; }
  #infoBox { background:#fff; padding:20px; border-radius:10px; box-shadow:0 4px 12px rgba(0,0,0,0.4); min-width:250px; max-width:400px; position:relative;}
  #infoClose { cursor:pointer; position:absolute; top:5px; right:10px; font-weight:bold; color:#333; }

  #downloadBtn { margin-top:10px; padding:12px 20px; border:none; background:#1e3a8a; color:#fff; font-weight:bold; cursor:pointer; border-radius:6px; font-size:16px; }
  #downloadBtn:hover { background:#2563eb; }

  #viewerOverlay { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.7); display:none; justify-content:center; align-items:center; backdrop-filter:blur(4px); opacity:0; transition: opacity 0.4s ease; }
  #viewerOverlay.show { display:flex; opacity:1; }

  #viewerBox { position: relative; box-shadow: 0 8px 20px rgba(0,0,0,0.5); border-radius:10px; transform: scale(0.8); transition: transform 0.4s ease; display:inline-block; }
  #viewerOverlay.show #viewerBox { transform: scale(1); }

  #viewerClose { position: absolute; top:-40px; right:0; font-size:28px; cursor:pointer; font-weight:bold; color:#fff; z-index:10; }

  #viewerImage, #viewerVideo {
    display:block;
    max-width:90vw;
    max-height:90vh;
    border-radius:8px;
    box-shadow:0 6px 15px rgba(0,0,0,0.5);
    transition: opacity 0.4s ease;
    opacity:0;
  }

  #viewerImage.show, #viewerVideo.show { opacity:1; }

  #imageBlocker { position:absolute; top:0; left:0; width:100%; height:100%; z-index:5; }

  #watermarkContainer { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); display: flex; align-items: center; pointer-events: none; z-index: 12; white-space: nowrap; }
  #watermark { font-size: 2vw; color: rgba(238,13,13,1); font-weight: bold; margin-right: 1vw; }
  #watermarkImage { height: 4vw; width: auto; }

  .videoControls { position: absolute; bottom:10px; left:50%; transform: translateX(-50%); display:flex; gap:15px; align-items:center; z-index:15; background: rgba(0,0,0,0.7); padding:10px 20px; border-radius:10px; opacity:1; transition: opacity 0.5s ease; }
  .videoButton { width:60px; height:60px; cursor:pointer; }

  #btnRestart { display:none; position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); z-index:20; cursor:pointer; width: 500px; height: 500px; }

  #copyrightNotice { position: fixed; bottom: 10px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.6); color: #fff; font-size: 0.7vw; padding: 8px 16px; border-radius: 8px; z-index: 20; text-align: center; font-family: 'Segoe UI', sans-serif; pointer-events: none; }
</style>

<!-- piexifjs pour remplacer exif-js et √©viter eval() -->
<script src="https://cdn.jsdelivr.net/npm/piexifjs@1.0.6/piexif.min.js"></script>

</head>

<body>

<h2>Explorateur de fichiers</h2>
<div id="fileTree"></div>

<!-- Info modal -->
<div id="infoOverlay">
  <div id="infoBox">
    <div id="infoClose" onclick="closeInfo()">X</div>
    <h3>Informations du fichier</h3>

    <div id="infoContent"></div>

    <div id="fileIDContainer" style="margin-top:10px; margin-bottom:5px; display:flex; align-items:center; gap:10px;">
      <span id="fileID" style="font-weight:bold;"></span>
      <button onclick="copyFileID()" style="padding:4px 8px; cursor:pointer;">Copier</button>
    </div>

    <button id="downloadBtn" onclick="downloadFile()">T√©l√©charger</button>
  </div>
</div>

<!-- Viewer modal -->
<div id="viewerOverlay">
  <div id="viewerBox">
    <img id="btnRestart" class="videoButton" src="par/res.png" />
    <div id="viewerClose" onclick="closeViewer()">X</div>

    <img id="viewerImage" src="">
    <div id="imageBlocker"></div>

    <div id="watermarkContainer">
      <span id="watermark">@roman_manero</span>
      <img id="watermarkImage" src="par/watermark.png" alt="Logo" />
    </div>

    <div class="videoControls" id="videoControls" style="display:none;">
      <img id="btnMinus5" class="videoButton" src="par/moins5.png">
      <img id="btnPlayPause" class="videoButton" src="par/2.png">
      <img id="btnPlus15" class="videoButton" src="par/plus15.png">
      <img id="btnMute" class="videoButton" src="par/on.png">
    </div>
  </div>
</div>

<script>
/* ===========
   FORCE DOWNLOAD (GLOBAL)
   =========== */
function triggerDownload(path) {
  const a = document.createElement("a");
  a.href = path;
  a.download = path.split("/").pop();
  document.body.appendChild(a);
  a.click();
  a.remove();
}

const files = {
  images: {
    "eau_de_toilette00.png": { path: "images/eau_de_toilette00.png", pin: null },
    "troupeau_d'ornythorinque_toxique.jpg": { path: "images/troupeau_dornythorinque_toxique.jpg", pin: null },
    "eurk.jpg": { path: "images/eurk.jpg", pin: null },
    "momo86.jpg": { path: "images/momo86.jpg", pin: null },
    "pin_6969.webp": { path: "images/pin_6969.webp", pin: "6969" },
    "basam.webp": { path: "images/basam.webp", pin: null },
    "1000024398.webp": { path: "images/1000024398.webp", pin: null },
    "image_1.webp": { path: "images/image_1.webp", pin: null },
    "1incorrect_2incorrect_3correct.webp": { path: "images/1incorrect_2incorrect_3correct.webp", pin: null },
    "drunch.webp": { path: "images/drunch.webp", pin: null }
  },
  videos: {
    "franco1short_9x16.mp4": { path: "videos/franco1short_9x16.mp4", pin: "cacahu√®te43" },
    "shokofama.mp4": { path: "videos/shokofama.mp4", pin: null },
    "suck1.mp4": { path: "videos/suck1.mp4", pin: null },
    "suck2.mp4": { path: "videos/suck2.mp4", pin: null },
    "suck3.mp4": { path: "videos/suck3.mp4", pin: null },
    "ŸáŸÑ ŸáŸÖ ÿ∑ÿ®ŸäÿπŸäŸàŸÜ - ÿ¨ŸàŸÜŸä ÿ≥ŸäŸÜÿ≥ (3) (1).mp4": { path: "videos/ŸáŸÑ ŸáŸÖ ÿ∑ÿ®ŸäÿπŸäŸàŸÜ - ÿ¨ŸàŸÜŸä ÿ≥ŸäŸÜÿ≥ (3) (1).mp4", pin: "sin" },
    "gif.mp4": { path: "videos/gif.mp4", pin: null },
    "XJP.mp4": { path: "videos/Xin jin ping (pong) naked simulator V1.432.mp4", pin: "yes_omerta" },
    "lv_0_20251120165138.mp4": { path: "videos/lv_0_20251120165138.mp4", pin: null },
    "sorrynotsory.gif": { path: "videos/sorrynotsory.gif", pin: null },
    "11mamoutlaineuxdanmontroupersonel.mp4": { path: "videos/11mamoutlaineuxdanmontroupersonel.mp4", pin: "grosQ" }
  },
  audio: {
    "kokolakochi.mp3": { path: "audios/kokolakochi.mp3", pin: null },
    "ofenta.mp3": { path: "audios/ofenta.mp3", pin: "√¥Canada" }
  },
  download: {
    "test.pdf": { path: "download/test.pdf", pin: null },
  }
};

let currentFile = null;

function createTree(container,obj){
  for(let key in obj){
    const item=document.createElement('div');

    if(typeof obj[key]==='object' && obj[key].path===undefined){
      item.textContent=key;
      item.className='folder';

      const nested=document.createElement('div');
      nested.className='nested';

      createTree(nested,obj[key]);

      item.onclick=()=>nested.classList.toggle('show');

      container.appendChild(item);
      container.appendChild(nested);
    } else {

      const file=obj[key];
      item.className='file';

      const label=document.createElement("span");
      label.textContent=key;

      const info=document.createElement("span");
      info.textContent="‚ãÆ";
      info.className="infoBtn";

      info.onclick=(e)=>{
        e.stopPropagation();
        openInfo(file,key);
      };

      item.appendChild(label);
      item.appendChild(info);

      if(file.pin) item.classList.add('locked');

      /* ======= CLICK LOGIC (UNIQUE) ======= */
      item.onclick = () => {

        // T√©l√©chargement direct pour le dossier download/
        if (file.path.startsWith("download/")) {
          triggerDownload(file.path);
          return;
        }

        // Protection par PIN si n√©cessaire
        if (file.pin) {
          const p = prompt("Entrez le PIN :");
          if (p !== file.pin) {
            alert("PIN incorrect !");
            return;
          }
        }

        // Sinon ouverture dans viewer
        openViewer(file.path);
      };

      container.appendChild(item);
    }
  }
}

/* --- Info modal --- */
async function openInfo(file, filename) {
  currentFile=file;

  const overlay = document.getElementById("infoOverlay");
  const content = document.getElementById("infoContent");
  const fileID = document.getElementById("fileID");

  const url = file.path;
  const ext = url.split(".").pop().toLowerCase();

  let infos = {
    nom: filename,
    taille:"Chargement...",
    dimensions:"‚Äì",
    longueur:"‚Äì",
    date:"‚Äì",
    lieu:"‚Äì",
    type:"‚Äì",
    lastModified:"‚Äì"
  };

  const randID = Math.floor(100000 + Math.random() * 900000);
  fileID.textContent = randID;

  try {
    const head = await fetch(url,{ method:"HEAD" });
    const size = head.headers.get("Content-Length");
    const lastMod = head.headers.get("Last-Modified");
    const mime = head.headers.get("Content-Type");

    if(size) infos.taille=(size/1024/1024).toFixed(2)+" Mo";
    if(lastMod) infos.lastModified=lastMod;
    if(mime) infos.type=mime;
  } catch {}

  if(["jpg","jpeg","png","webp"].includes(ext)){
    const img = new Image();
    img.src=url;

    img.onload = () => {
      infos.dimensions = img.width+" x "+img.height;

      // --- PIEEXIFJS pour CSP ---
      try {
        fetch(url)
          .then(res => res.blob())
          .then(blob => blob.arrayBuffer())
          .then(buffer => {
            const data = new Uint8Array(buffer);
            const exifObj = piexif.load(data);
            infos.date = exifObj?.Exif?.["DateTimeOriginal"] || "‚Äì";
            const lat = exifObj?.GPS?.GPSLatitude;
            const lon = exifObj?.GPS?.GPSLongitude;
            if(lat && lon) infos.lieu = lat + " / " + lon;
            showInfo();
          });
      } catch(e){ showInfo(); }

      // Affiche quand m√™me les dimensions si EXIF √©choue
      showInfo();
    };

  } else if(["mp4","webm","ogg"].includes(ext)){
    const vid = document.createElement("video");
    vid.src=url;

    vid.onloadedmetadata = () => {
      infos.longueur = vid.duration.toFixed(1)+" sec";
      infos.dimensions=vid.videoWidth+" x "+vid.videoHeight;
      showInfo();
    };
  }
  else showInfo();

  function showInfo(){
    content.innerHTML=`
      <p><strong>Nom :</strong> ${infos.nom}</p>
      <p><strong>Taille :</strong> ${infos.taille}</p>
      <p><strong>Dimensions :</strong> ${infos.dimensions}</p>
      <p><strong>Dur√©e :</strong> ${infos.longueur}</p>
      <p><strong>Type :</strong> ${infos.type}</p>
      <p><strong>Date prise :</strong> ${infos.date}</p>
      <p><strong>Lieu :</strong> ${infos.lieu}</p>
      <p><strong>Derni√®re modif :</strong> ${infos.lastModified}</p>
    `;
    overlay.style.display="flex";
  }
}

function copyFileID(){
  const fileID = document.getElementById("fileID").textContent;
  navigator.clipboard.writeText(fileID)
    .then(()=>{ alert("ID copi√©: "+fileID); });
}

function closeInfo(){
  document.getElementById("infoOverlay").style.display="none";
}

function downloadFile(){
  const pin = prompt("Entrez le PIN de t√©l√©chargement :");
  if(pin!=="1bananepoilue+1herisson016"){
    alert("PIN incorrect !");
    return;
  }

  if(currentFile){
    const a = document.createElement("a");
    a.href=currentFile.path;
    a.download=currentFile.path.split("/").pop();
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
  }
}

/* --- Viewer --- */
/* (inchang√© ‚Äî intact) */
</script>

<div id="copyrightNotice">
  ‚ö†Ô∏è Tous les contenus diffus√©s sur ce site ont √©t√© cr√©√©s par moi ou trouv√©s sur Google.
  Si vous √™tes le d√©tenteur l√©gal d‚Äôune ≈ìuvre et estimez qu‚Äôelle a √©t√© utilis√©e sans autorisation,
  veuillez me contacter imm√©diatement √† <strong>mazmogetjr@gmail.com</strong> pour demander son retrait.
  Votre requ√™te sera trait√©e rapidement afin de respecter vos droits.
</div>

</body>
</html>
